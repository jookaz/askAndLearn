"use strict";(self["webpackChunkteacher_ai"]=self["webpackChunkteacher_ai"]||[]).push([[865],{1865:function(e,a,t){t.r(a),t.d(a,{default:function(){return x}});t(4114);var l=t(6768),s=t(4232),n=t(5130),u=t(144),r=t(1387),o=t(5720),d=t(1219),c=t(2933),i=t(6377),m=t(782);const p={class:"question-detail"},b={class:"markdown-container"},k={class:"message student"},v={class:"bubble"},g={class:"message answer"},h={class:"bubble"},f={class:"chat-container"},y={class:"chat-messages"},_={class:"role-icon"},w={class:"content"},I={key:0,class:"chat-input"},L={key:2,class:"completion-alert"};var F={__name:"QuestionDetailView",setup(e){const a=(0,u.KR)([]),t=(0,u.KR)(!1),F=(0,u.KR)([]),R=(0,u.KR)(!1),C=(0,u.KR)(""),x=(0,u.KR)(!1),K=(0,r.lq)(),V=(0,u.KR)(""),q=(0,u.KR)(""),A=(0,u.KR)(null),S=(0,u.KR)(!1),E=(0,u.KR)(!1),P=(0,u.Kh)({studentReason:"",answerId:null}),X=e=>{if(e.shiftKey&&"Enter"===e.key)return!0;"Enter"===e.key&&(e.preventDefault(),j())};(0,l.sV)((async()=>{try{const e=Number(K.params.questionId),a=await o.A.get("/student/question/detail",{params:{questionId:e}});V.value=a.data.data.questionContent,q.value=a.data.data.answerContent,A.value=a.data.data.answerId,console.log("获取到回答ID:",A.value)}catch(e){console.error("获取问题详情失败:",e)}}));const N=(0,u.Kh)({score:null,submittedScore:null}),W=async()=>{try{D.value=!0;const e=await o.A.put("/student/studentAnswer",{answerId:A.value,anotherStudentScore:N.score});1===e.data?.code&&(d.nk.success("评分提交成功"),N.submittedScore=N.score,N.score=null,R.value=!0,F.value=["chat"])}finally{D.value=!1}},D=(0,u.KR)(!1),U={score:[{required:!0,message:"请输入评分",trigger:"blur"},{type:"number",min:1,max:100,message:"评分范围1-100",trigger:["blur","change"]}]},Q={studentReason:[{required:!0,message:"必须输入回答理由",trigger:"blur"},{min:1,message:"理由不可以为空",trigger:"blur"}]},T=(0,m.Pj)(),j=async()=>{try{if(!C.value.trim())return;x.value=!0,a.value.push({role:"user",content:C.value});const e=await o.A.post("/student/someoneAsk/chat/improveAnswer",{prompt:C.value,userId:Number(localStorage.getItem("student-id")),courseId:T.getters["chapter/getCurrentChapterParams"].courseId,chapterId:T.getters["chapter/getCurrentChapterParams"].chapterId,questionId:Number(K.params.questionId),question:V.value},{timeout:3e5});1===e.data?.code?(a.value.push({role:"assistant",content:e.data.data.response}),e.data.data.flag&&(P.answerId=e.data.data.id,S.value=!0,await o.A.put("/student/question/updateIfSelect",null,{params:{questionId:Number(K.params.questionId)}}),E.value=!0,await(0,i.X)({userId:Number(localStorage.getItem("student-id")),courseId:T.getters["chapter/getCurrentChapterParams"].courseId,chapterId:T.getters["chapter/getCurrentChapterParams"].chapterId,step:3}),d.nk.success("进度已更新")),C.value=""):c.s.confirm("大模型服务连接异常，错误信息: "+(e.data?.message||"未知错误")+"，请刷新页面重试","服务不可用",{confirmButtonText:"立即刷新",cancelButtonText:"取消",type:"error"}).then((()=>{location.reload()}))}catch(e){d.nk.error("请求失败: "+e.message)}finally{x.value=!1}},z=async()=>{try{const e=await o.A.put("/student/studentImproveAnswer/reason",{answerId:P.answerId,studentReason:P.studentReason});1===e.data?.code&&(d.nk.success("理由提交成功"),S.value=!1,E.value=!0)}catch(e){d.nk.error("提交失败: "+e.message)}};return(e,u)=>{const r=(0,l.g2)("el-button"),o=(0,l.g2)("el-alert"),d=(0,l.g2)("el-descriptions-item"),c=(0,l.g2)("el-descriptions"),i=(0,l.g2)("el-dialog"),m=(0,l.g2)("el-input-number"),K=(0,l.g2)("el-form-item"),A=(0,l.g2)("el-form"),T=(0,l.g2)("el-input"),B=(0,l.g2)("el-collapse-item"),O=(0,l.g2)("el-collapse"),$=(0,l.g2)("el-card");return(0,l.uX)(),(0,l.CE)("div",p,[(0,l.bF)(r,{type:"primary",onClick:u[0]||(u[0]=e=>t.value=!0),class:"mb-4"},{default:(0,l.k6)((()=>u[7]||(u[7]=[(0,l.eW)(" 📝 评分标准 ")]))),_:1}),(0,l.bF)(i,{modelValue:t.value,"onUpdate:modelValue":u[1]||(u[1]=e=>t.value=e),title:"评分标准",width:"720px"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",b,[(0,l.bF)(o,{title:"先判断回答相关性，再根据以下标准评分",type:"info",closable:!1,class:"mb-4"}),(0,l.bF)(c,{border:"",column:1,title:"评分细则"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{label:"80-100分 | 完美回答"},{default:(0,l.k6)((()=>u[8]||(u[8]=[(0,l.Lk)("span",{class:"text-emerald-600 font-medium"},"✅ 完全准确、完整、逻辑严密",-1),(0,l.Lk)("pre",{class:"example"},'示例：\n          问题：什么是光合作用\n          回答："光合作用分为光反应和暗反应：\n          1. 光反应中叶绿体吸收光能分解水\n          2. 释放氧气并生成ATP和NADPH\n          3. 暗反应通过卡尔文循环固定CO₂生成葡萄糖"',-1)]))),_:1}),(0,l.bF)(d,{label:"60-80分 | 优秀回答"},{default:(0,l.k6)((()=>u[9]||(u[9]=[(0,l.Lk)("span",{class:"text-blue-600 font-medium"},"✏️ 正确但简略，逻辑清晰",-1),(0,l.Lk)("pre",{class:"example"},'示例：\n          回答："光合作用是植物利用光能将CO₂和水\n          转化为葡萄糖的过程，分为光反应和暗反应"',-1)]))),_:1}),(0,l.bF)(d,{label:"40-60分 | 基本正确"},{default:(0,l.k6)((()=>u[10]||(u[10]=[(0,l.Lk)("span",{class:"text-orange-600 font-medium"},"⚠️ 存在小错误/信息不完整",-1),(0,l.Lk)("pre",{class:"example"},'示例：\n          回答："光合作用是植物制造食物的过程\n          需要阳光、水和二氧化碳，产生氧气"',-1)]))),_:1}),(0,l.bF)(d,{label:"20-40分 | 部分错误"},{default:(0,l.k6)((()=>u[11]||(u[11]=[(0,l.Lk)("span",{class:"text-rose-600 font-medium"},"❌ 明显错误/偏离主题",-1),(0,l.Lk)("pre",{class:"example"},'示例：\n          回答："光合作用就是植物吸收阳光\n          然后产生能量供自己使用"',-1)]))),_:1}),(0,l.bF)(d,{label:"1-20分 | 完全错误"},{default:(0,l.k6)((()=>u[12]||(u[12]=[(0,l.Lk)("span",{class:"text-red-700 font-medium"},"⛔ 无关/无法理解",-1),(0,l.Lk)("pre",{class:"example"},'示例：\n          回答："光合作用是动物消化食物的方式"',-1)]))),_:1})])),_:1})])])),_:1},8,["modelValue"]),(0,l.bF)($,{class:"dialog-container"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",k,[u[14]||(u[14]=(0,l.Lk)("div",{class:"avatar"},"👤",-1)),(0,l.Lk)("div",v,[u[13]||(u[13]=(0,l.Lk)("h3",null,"学生提问",-1)),(0,l.Lk)("p",null,(0,s.v_)(V.value),1)])]),(0,l.Lk)("div",g,[u[21]||(u[21]=(0,l.Lk)("div",{class:"avatar"},"📝",-1)),(0,l.Lk)("div",h,[u[20]||(u[20]=(0,l.Lk)("h3",null,"学生答案",-1)),(0,l.Lk)("pre",null,(0,s.v_)(q.value),1),(0,l.bF)(A,{model:N,rules:U,onSubmit:(0,n.D$)(W,["prevent"])},{default:(0,l.k6)((()=>[(0,l.bF)(K,{label:"请输入评分（1-100）",prop:"score"},{default:(0,l.k6)((()=>[(0,l.bF)(m,{modelValue:N.score,"onUpdate:modelValue":u[2]||(u[2]=e=>N.score=e),min:1,max:100,placeholder:N.submittedScore?"已提交评分："+N.submittedScore:"请输入评分","controls-position":"right"},null,8,["modelValue","placeholder"])])),_:1}),(0,l.bF)(r,{type:"primary","native-type":"submit",loading:D.value},{default:(0,l.k6)((()=>u[15]||(u[15]=[(0,l.eW)(" 提交评分 ")]))),_:1},8,["loading"])])),_:1},8,["model"]),(0,l.bF)(O,{modelValue:F.value,"onUpdate:modelValue":u[6]||(u[6]=e=>F.value=e)},{default:(0,l.k6)((()=>[(0,l.bF)(B,{name:"chat",disabled:!R.value},{title:(0,l.k6)((()=>u[16]||(u[16]=[(0,l.Lk)("span",{class:"chat-title"},"💬 改进该学生的答案",-1)]))),default:(0,l.k6)((()=>[(0,l.Lk)("div",f,[(0,l.Lk)("div",y,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.value,((e,a)=>((0,l.uX)(),(0,l.CE)("div",{key:a,class:(0,s.C4)(["message",e.role])},[(0,l.Lk)("div",_,(0,s.v_)("user"===e.role?"👤":"🤖"),1),(0,l.Lk)("div",w,(0,s.v_)(e.content),1)],2)))),128))]),E.value?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",I,[(0,l.bF)(T,{modelValue:C.value,"onUpdate:modelValue":u[3]||(u[3]=e=>C.value=e),placeholder:"输入您的回答...",clearable:"",type:"textarea",rows:3,autosize:{minRows:3,maxRows:6},onKeyup:(0,n.jR)(X,["enter"])},null,8,["modelValue"]),(0,l.bF)(r,{type:"primary",onClick:j,loading:x.value,style:{"margin-top":"10px"}},{default:(0,l.k6)((()=>u[17]||(u[17]=[(0,l.eW)(" 发送 ")]))),_:1},8,["loading"])])),S.value?((0,l.uX)(),(0,l.Wv)(o,{key:1,title:"请说明回答理由",type:"warning",closable:!1,class:"mb-4"},{default:(0,l.k6)((()=>[(0,l.bF)(A,{model:P,rules:Q},{default:(0,l.k6)((()=>[(0,l.bF)(K,{label:"回答理由",prop:"studentReason",class:"reason-input"},{default:(0,l.k6)((()=>[(0,l.bF)(T,{modelValue:P.studentReason,"onUpdate:modelValue":u[4]||(u[4]=e=>P.studentReason=e),type:"textarea",rows:4,autosize:{minRows:4,maxRows:8},placeholder:"请详细说明您给出此回答的理由",style:{width:"600px"}},null,8,["modelValue"])])),_:1}),(0,l.bF)(r,{type:"primary",onClick:z,disabled:!P.studentReason.trim()},{default:(0,l.k6)((()=>u[18]||(u[18]=[(0,l.eW)(" 提交理由 ")]))),_:1},8,["disabled"])])),_:1},8,["model"])])),_:1})):(0,l.Q3)("",!0),E.value?((0,l.uX)(),(0,l.CE)("div",L,[(0,l.bF)(o,{title:"🎉 任务完成",type:"success",description:"恭喜您完成本章节的他问你答！可返回课程列表继续学习其他章节。",closable:!1},{extra:(0,l.k6)((()=>[(0,l.bF)(r,{type:"primary",onClick:u[5]||(u[5]=a=>e.$router.push({name:"courses"})),class:"back-btn"},{default:(0,l.k6)((()=>u[19]||(u[19]=[(0,l.eW)(" 返回课程列表 ")]))),_:1})])),_:1})])):(0,l.Q3)("",!0)])])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])])])),_:1})])}}},R=t(1241);const C=(0,R.A)(F,[["__scopeId","data-v-2bca4155"]]);var x=C}}]);
//# sourceMappingURL=865.2c7e4116.js.map