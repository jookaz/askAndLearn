"use strict";(self["webpackChunkteacher_ai"]=self["webpackChunkteacher_ai"]||[]).push([[847],{8847:function(e,a,l){l.r(a),l.d(a,{default:function(){return F}});l(8111),l(1701);var t=l(6768),r=l(144),u=l(1219),o=l(2933),c=(l(4114),l(9791)),n={__name:"CourseForm",props:{modelValue:Boolean,courseData:Object},emits:["update:modelValue","submit"],setup(e,{emit:a}){const l=e,o=a,n=(0,t.EW)({get:()=>l.modelValue,set:e=>o("update:modelValue",e)}),d=(0,r.KR)(localStorage.getItem("teacher-info")),i=(0,r.KR)(localStorage.getItem("teacher-id")),s=(0,r.KR)({teacherId:i.value,courseName:"",description:"",image:"",chapters:[]});(0,t.wB)((()=>l.courseData),(e=>{e&&(s.value={...e,chapters:e.chapters?.map((e=>({id:e.id,chapterName:e.chapterName,chapterOrder:e.chapterOrder})))||[]})}));const p=(0,t.EW)((()=>s.value.id?"编辑课程":"新建课程")),m=()=>{s.value.chapters.push({chapterName:"",chapterOrder:s.value.chapters.length+1})},g=e=>{s.value.chapters.splice(e,1)},h=e=>{const a=["image/jpeg","image/png"].includes(e.type);return!!a||(u.nk.error("只能上传 JPG/PNG 格式的图片!"),!1)},v=async e=>{try{const a=await(0,c.c0)(e.file,"teacher-course-image");1===a.data.code&&(s.value.image=a.data.data)}catch(a){u.nk.error("上传失败")}},b=()=>{o("submit",s.value),n.value=!1,s.value={teacherId:null,courseName:"",description:"",image:"",chapters:[]}};return(e,a)=>{const l=(0,t.g2)("el-image"),r=(0,t.g2)("el-button"),u=(0,t.g2)("el-upload"),o=(0,t.g2)("el-form-item"),c=(0,t.g2)("el-input"),i=(0,t.g2)("el-input-number"),k=(0,t.g2)("el-form"),f=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.Wv)(f,{modelValue:n.value,"onUpdate:modelValue":a[4]||(a[4]=e=>n.value=e),title:p.value,width:"800px"},{footer:(0,t.k6)((()=>[(0,t.bF)(r,{onClick:a[3]||(a[3]=e=>n.value=!1)},{default:(0,t.k6)((()=>a[8]||(a[8]=[(0,t.eW)(" 取消 ")]))),_:1}),(0,t.bF)(r,{type:"primary",onClick:b},{default:(0,t.k6)((()=>a[9]||(a[9]=[(0,t.eW)(" 提交 ")]))),_:1})])),default:(0,t.k6)((()=>[(0,t.bF)(k,{model:s.value,"label-width":"100px"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{label:"课程封面"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{"http-request":v,"before-upload":h,"show-file-list":!1,accept:".jpg,.png"},{default:(0,t.k6)((()=>[s.value.image?((0,t.uX)(),(0,t.Wv)(l,{key:0,src:s.value.image,fit:"cover",class:"preview-image"},null,8,["src"])):((0,t.uX)(),(0,t.Wv)(r,{key:1,type:"primary"},{default:(0,t.k6)((()=>a[5]||(a[5]=[(0,t.eW)(" 点击上传 ")]))),_:1}))])),_:1})])),_:1}),(0,t.bF)(o,{label:"课程名称",prop:"courseName"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{modelValue:s.value.courseName,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value.courseName=e)},null,8,["modelValue"])])),_:1}),(0,t.bF)(o,{label:"授课教师",prop:"teacherId"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=e=>d.value=e),disabled:"",placeholder:"当前登录教师"},null,8,["modelValue"])])),_:1}),(0,t.bF)(o,{label:"课程描述",prop:"description"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{modelValue:s.value.description,"onUpdate:modelValue":a[2]||(a[2]=e=>s.value.description=e),type:"textarea",rows:"4"},null,8,["modelValue"])])),_:1}),(0,t.bF)(o,{label:"课程章节"},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(s.value.chapters,((e,l)=>((0,t.uX)(),(0,t.CE)("div",{key:l},[(0,t.bF)(c,{modelValue:e.chapterName,"onUpdate:modelValue":a=>e.chapterName=a,placeholder:"章节名称",style:{width:"200px","margin-right":"10px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,t.bF)(i,{modelValue:e.chapterOrder,"onUpdate:modelValue":a=>e.chapterOrder=a,min:1,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"]),(0,t.bF)(r,{type:"danger",icon:"el-icon-delete",style:{"margin-left":"10px"},onClick:e=>g(l)},{default:(0,t.k6)((()=>a[6]||(a[6]=[(0,t.eW)(" 删除 ")]))),_:2},1032,["onClick"])])))),128)),(0,t.bF)(r,{type:"primary",onClick:m},{default:(0,t.k6)((()=>a[7]||(a[7]=[(0,t.eW)(" 添加章节 ")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])}}};const d=n;var i=d,s=l(5720);const p=e=>(0,s.A)({url:"/teacher/courses/page",method:"GET",params:e}),m=e=>s.A.delete("/teacher/courses",{params:{ids:e.join(",")},paramsSerializer:{indexes:null}}),g=e=>(0,s.A)({url:"/teacher/courses",method:"POST",data:e}),h=e=>(0,s.A)({url:"/teacher/courses",method:"PUT",data:e}),v=e=>(0,s.A)({url:`/teacher/courses/${e}`,method:"get"}),b={class:"course-manage"},k={class:"toolbar"};var f={__name:"CourseManageView",setup(e){const a=(0,r.KR)(1),l=(0,r.KR)(10),c=(0,r.KR)(0),n=(0,r.KR)([]),d=(0,r.KR)(!1),s=async()=>{d.value=!0;try{const e=await p({pageNo:a.value,pageSize:l.value});n.value=e.data.data.records||[],c.value=e.data.data.total||0}catch(e){console.error("获取课程列表失败:",e),u.nk.error("数据加载失败")}finally{d.value=!1}};(0,t.wB)([a,l],s),s();const f=(0,r.KR)([]),y=e=>{f.value=e.map((e=>e.id))},F=async e=>{try{await o.s.confirm("确定要删除该课程吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await m([e]),u.nk.success("删除成功"),s()}catch(a){"cancel"!==a&&u.nk.error("删除失败："+a.message)}},V=async()=>{if(0!==f.value.length)try{await o.s.confirm(`确定要删除选中的${f.value.length}门课程吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await m(f.value),u.nk.success("批量删除成功"),s()}catch(e){"cancel"!==e&&u.nk.error("删除失败："+e.message)}else u.nk.warning("请先选择要删除的课程")},w=(0,r.KR)(!1),_=(0,r.KR)(null);(0,t.wB)(w,(e=>{e||(_.value=null)}));const C=()=>{_.value=null,w.value=!0},W=async e=>{try{const a=await v(e.id);_.value={...a.data.data,chapters:a.data.data.chapters},w.value=!0}catch(a){u.nk.error("获取课程详情失败")}},x=async e=>{try{e.id?await h({...e,image:e.image,chapterList:e.chapters}):await g({...e,image:e.image}),s()}catch(a){console.error("提交失败:",a)}};return(e,r)=>{const u=(0,t.g2)("el-button"),o=(0,t.g2)("el-table-column"),s=(0,t.g2)("el-table"),p=(0,t.g2)("el-pagination"),m=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",b,[(0,t.Lk)("div",k,[(0,t.bF)(u,{type:"primary",onClick:C},{default:(0,t.k6)((()=>r[3]||(r[3]=[(0,t.eW)(" 新建课程 ")]))),_:1}),(0,t.bF)(u,{type:"danger",onClick:V},{default:(0,t.k6)((()=>r[4]||(r[4]=[(0,t.eW)(" 批量删除 ")]))),_:1})]),(0,t.bo)(((0,t.uX)(),(0,t.Wv)(s,{data:n.value,border:"",stripe:"","element-loading-text":"数据加载中...","empty-text":"暂无课程数据",onSelectionChange:y},{default:(0,t.k6)((()=>[(0,t.bF)(o,{type:"selection",width:"55"}),(0,t.bF)(o,{prop:"courseName",label:"课程名称"}),(0,t.bF)(o,{prop:"description",label:"课程描述"}),(0,t.bF)(o,{label:"操作",width:"200"},{default:(0,t.k6)((({row:e})=>[(0,t.bF)(u,{size:"small",onClick:a=>W(e)},{default:(0,t.k6)((()=>r[5]||(r[5]=[(0,t.eW)(" 编辑 ")]))),_:2},1032,["onClick"]),(0,t.bF)(u,{size:"small",type:"danger",onClick:a=>F(e.id)},{default:(0,t.k6)((()=>r[6]||(r[6]=[(0,t.eW)(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[m,d.value]]),(0,t.bF)(p,{"current-page":a.value,"onUpdate:currentPage":r[0]||(r[0]=e=>a.value=e),"page-size":l.value,"onUpdate:pageSize":r[1]||(r[1]=e=>l.value=e),background:"","page-sizes":[10,20,30],layout:"total, sizes, prev, pager, next",total:c.value},null,8,["current-page","page-size","total"]),(0,t.bF)(i,{modelValue:w.value,"onUpdate:modelValue":r[2]||(r[2]=e=>w.value=e),"course-data":_.value,onSubmit:x},null,8,["modelValue","course-data"])])}}};const y=f;var F=y}}]);
//# sourceMappingURL=847.8ed469b8.js.map