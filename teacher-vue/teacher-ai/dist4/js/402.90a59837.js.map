{"version":3,"file":"js/402.90a59837.js","mappings":"kmBA8EA,MAAMA,GAAQC,EAAAA,EAAAA,MACRC,GAAWC,EAAAA,EAAAA,IAAS,IACpBC,GAAeC,EAAAA,EAAAA,IAAI,IACnBC,GAAeD,EAAAA,EAAAA,KAAI,GACnBE,GAAYF,EAAAA,EAAAA,KAAI,GAChBG,GAAaH,EAAAA,EAAAA,IAAI,MAGvBI,EAAAA,GAAOC,WAAW,CAChBC,UAAWC,GAAQC,EAAAA,EAAKC,cAAcF,GAAMG,MAC5CC,QAAQ,IAGV,MAAMC,EAAkBC,GACfA,GAAUT,EAAAA,EAAAA,IAAOS,GAAW,GAG/BC,EAAeC,UACnB,GAAKhB,EAAaW,MAAMM,OAExB,IACEf,EAAaS,OAAQ,EACrB,MAAMO,EAAUlB,EAAaW,MAC7BX,EAAaW,MAAQ,GAGrBb,EAASqB,KAAK,CACZL,QAASI,EACTE,SAAU,iBAENC,EAAAA,EAAAA,MACNC,IAGA,MAAMC,QAAYC,EAAAA,EAAAA,IAAW,CAC3BC,OAAQP,EACRQ,OAAQC,OAAOC,aAAaC,QAAQ,eACpCC,SAAUH,OAAO/B,EAAMmC,OAAOD,UAC9BE,UAAWL,OAAO/B,EAAMmC,OAAOC,WAC/BC,SAAUrC,EAAMsC,MAAMD,SACtBE,WAAYR,OAAO/B,EAAMsC,MAAMC,cAIjC,GAAuB,IAAnBZ,EAAIa,MAAM5B,KAAY,CAExB,MAAM6B,EAAed,EAAIa,KAAKA,MAAQ,CAAC,EACjCE,EAAeD,EAAajB,UAAY,GAG9CtB,EAASA,EAASyC,OAAS,GAAGnB,SAAWkB,GAGf,IAAtBD,EAAaG,OACbrC,EAAUQ,OAAQ,GAGlB8B,EAAAA,EAAAA,GAAqB,CACjBf,OAAQC,OAAOC,aAAaC,QAAQ,eACpCC,SAAUH,OAAO/B,EAAMmC,OAAOD,UAC9BE,UAAWL,OAAO/B,EAAMmC,OAAOC,WAC/BU,KAAM,IAGhB,CACF,CAAE,MAAOC,GACPC,EAAAA,GAAUD,MAAM,QAAUA,EAAME,QAClC,CAAE,QACA3C,EAAaS,OAAQ,EACrBW,GACF,GAGIA,EAAiBA,KACjBlB,EAAWO,QACbP,EAAWO,MAAMmC,UAAY1C,EAAWO,MAAMoC,aAChD,E,0oDCpJF,MAAMC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://teacher-ai/./src/views/ImproveAnswerView.vue","webpack://teacher-ai/./src/views/ImproveAnswerView.vue?d94b"],"sourcesContent":["<template>\r\n  <div class=\"improve-container\">\r\n    <el-card class=\"question-header\">\r\n      <div class=\"header-content\">\r\n        <h3 style=\"color:#409EFF\">üìù ÈóÆÈ¢òÔºö{{ route.query.question }}</h3>\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- ÂØπËØùÂå∫ -->\r\n    <div class=\"chat-container\">\r\n      <div ref=\"messageBox\" class=\"message-list\">\r\n        <div v-for=\"(msg, index) in messages\" :key=\"index\" class=\"message-item\">\r\n          <!-- Áî®Êà∑Ê∂àÊÅØ -->\r\n          <div class=\"user-message\">\r\n            <el-icon class=\"avatar\"><User /></el-icon>\r\n            <div class=\"content-box\">\r\n              <div class=\"message-content\">\r\n                {{ msg.content }}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- AIÂìçÂ∫î -->\r\n          <div class=\"ai-response\">\r\n            <el-card class=\"response-card\">\r\n              <div class=\"response-content\" v-html=\"renderMarkdown(msg.response)\" />\r\n            </el-card>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- ËæìÂÖ•Âå∫ -->\r\n      <div v-if=\"showInput\" class=\"input-area\">\r\n        <el-input\r\n          v-model=\"inputMessage\"\r\n          type=\"textarea\"\r\n          :rows=\"4\"\r\n          placeholder=\"ËØ∑ËæìÂÖ•ÊÇ®ÁöÑËßÅËß£\"\r\n          :disabled=\"isSubmitting\"\r\n          @keyup.enter.prevent=\"handleSubmit\" \r\n        />\r\n        <el-button\r\n          type=\"primary\"\r\n          class=\"submit-btn\"\r\n          :loading=\"isSubmitting\"\r\n          @click=\"handleSubmit\"\r\n        >\r\n          Êèê‰∫§\r\n        </el-button>\r\n      </div>\r\n\r\n      <!-- ÂÆåÊàêÊèêÁ§∫ -->\r\n      <div v-else class=\"completion-tip\">\r\n        <el-result icon=\"success\" title=\"ÊÅ≠ÂñúÂÆåÊàêÊú¨Á´†ËäÇÂ≠¶‰π†ÔºÅ\">\r\n          <template #extra>\r\n            <el-button type=\"primary\" @click=\"$router.push({\r\n              name: 'AnswerSomeone',\r\n              params: {\r\n                courseId: route.params.courseId,  // ÂèÇÊï∞‰º†ÈÄí\r\n                chapterId: route.params.chapterId  // ÂèÇÊï∞‰º†ÈÄí\r\n              }\r\n            })\">Êü•Áúã‰ªñ‰∫∫ÈóÆÈ¢ò</el-button>\r\n          </template>\r\n        </el-result>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, nextTick } from 'vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport { useRoute } from 'vue-router'\r\nimport { marked } from 'marked'\r\nimport hljs from 'highlight.js'\r\nimport { chatAnswer } from '@/api/askyou'\r\nimport { updateProgressStatus } from '@/api/progress' // Êñ∞Â¢ûÊ≠§Ë°å\r\n\r\nconst route = useRoute()\r\nconst messages = reactive([])\r\nconst inputMessage = ref('')\r\nconst isSubmitting = ref(false)\r\nconst showInput = ref(true)\r\nconst messageBox = ref(null)\r\n\r\n// ÂàùÂßãÂåñMarkdownÈÖçÁΩÆ\r\nmarked.setOptions({\r\n  highlight: code => hljs.highlightAuto(code).value,\r\n  breaks: true\r\n})\r\n\r\nconst renderMarkdown = (content) => {\r\n  return content ? marked(content) : ''\r\n}\r\n\r\nconst handleSubmit = async () => {\r\n  if (!inputMessage.value.trim()) return\r\n\r\n  try {\r\n    isSubmitting.value = true\r\n    const userMsg = inputMessage.value\r\n    inputMessage.value = ''\r\n\r\n    // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ\r\n    messages.push({\r\n      content: userMsg,\r\n      response: 'ÊÄùËÄÉ‰∏≠...'\r\n    })\r\n    await nextTick()\r\n    scrollToBottom()\r\n\r\n    // Ë∞ÉÁî®Êé•Âè£\r\n    const res = await chatAnswer({\r\n      prompt: userMsg,\r\n      userId: Number(localStorage.getItem('student-id')),\r\n      courseId: Number(route.params.courseId),\r\n      chapterId: Number(route.params.chapterId),\r\n      question: route.query.question,\r\n      questionId: Number(route.query.questionId)\r\n    })\r\n\r\n    // ‰øÆÊîπhandleSubmitÊñπÊ≥ï‰∏≠ÁöÑÊàêÂäüÂõûË∞É\r\n    if (res.data?.code === 1) {\r\n      // ‰øÆÊîπ‰∏∫Ëé∑ÂèñÂµåÂ•óÁöÑresponseÂ≠óÊÆµ\r\n      const responseData = res.data.data || {}\r\n      const lastResponse = responseData.response || ''\r\n      \r\n      // Êõ¥Êñ∞ÊúÄÂêé‰∏ÄÊù°Ê∂àÊÅØÁöÑÂìçÂ∫î\r\n      messages[messages.length - 1].response = lastResponse\r\n      \r\n      // ‰øÆÊîπÂà§Êñ≠ÈÄªËæë‰∏∫‰ΩøÁî®flagÂ≠óÊÆµ\r\n      if (responseData.flag === true) {\r\n          showInput.value = false\r\n          \r\n          // Âú®ÈöêËóèËæìÂÖ•Ê†èÊó∂Êõ¥Êñ∞ËøõÂ∫¶Ôºàstep 3Ôºâ\r\n          updateProgressStatus({\r\n              userId: Number(localStorage.getItem('student-id')),\r\n              courseId: Number(route.params.courseId),\r\n              chapterId: Number(route.params.chapterId),\r\n              step: 3\r\n          })\r\n      }\r\n    }\r\n  } catch (error) {\r\n    ElMessage.error('Êèê‰∫§Â§±Ë¥•Ôºö' + error.message)\r\n  } finally {\r\n    isSubmitting.value = false\r\n    scrollToBottom()\r\n  }\r\n}\r\n\r\nconst scrollToBottom = () => {\r\n  if (messageBox.value) {\r\n    messageBox.value.scrollTop = messageBox.value.scrollHeight\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.back-btn {\r\n  margin-bottom: 20px;\r\n  padding: 10px 20px;\r\n  border-radius: 18px;\r\n  box-shadow: 0 2px 8px rgba(64, 158, 255, 0.2);\r\n  transition: transform 0.3s;\r\n}\r\n\r\n.back-btn:hover {\r\n  transform: translateY(-2px);\r\n}\r\n/* Â§çÁî®ChapterDetailViewÁöÑÊ†∑Âºè */\r\n.improve-container {\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n}\r\n\r\n.chat-container {\r\n  margin-top: 20px;\r\n  border: 1px solid #ebeef5;\r\n  border-radius: 4px;\r\n  background: #f8f9fa;\r\n}\r\n\r\n.message-list {\r\n  height: 60vh;\r\n  padding: 20px;\r\n  overflow-y: auto;\r\n  scroll-behavior: smooth;\r\n}\r\n\r\n.message-item {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.user-message {\r\n  display: flex;\r\n  align-items: start;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.avatar {\r\n  font-size: 28px;\r\n  margin-right: 15px;\r\n  color: #409eff;\r\n}\r\n\r\n.content-box {\r\n  flex: 1;\r\n}\r\n\r\n.message-content {\r\n  background: #fff;\r\n  padding: 15px;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n}\r\n\r\n.input-area {\r\n  padding: 20px;\r\n  background: #fff;\r\n  border-top: 1px solid #ebeef5;\r\n  display: flex;\r\n  gap: 15px;\r\n  flex-direction: column;\r\n}\r\n\r\n.submit-btn {\r\n  width: 120px;\r\n  margin-left: auto;\r\n}\r\n\r\n.completion-tip {\r\n  padding: 20px;\r\n  text-align: center;\r\n}\r\n\r\n/* ÂìçÂ∫îÂç°ÁâáÊ†∑Âºè */\r\n.ai-response {\r\n  margin-top: 15px;\r\n}\r\n\r\n.response-card {\r\n  background: #f6f8fa;\r\n  border-radius: 8px;\r\n}\r\n\r\n.response-content {\r\n  padding: 15px;\r\n  line-height: 1.6;\r\n}\r\n</style>","import script from \"./ImproveAnswerView.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ImproveAnswerView.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ImproveAnswerView.vue?vue&type=style&index=0&id=208049fc&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-208049fc\"]])\n\nexport default __exports__"],"names":["route","useRoute","messages","reactive","inputMessage","ref","isSubmitting","showInput","messageBox","marked","setOptions","highlight","code","hljs","highlightAuto","value","breaks","renderMarkdown","content","handleSubmit","async","trim","userMsg","push","response","nextTick","scrollToBottom","res","chatAnswer","prompt","userId","Number","localStorage","getItem","courseId","params","chapterId","question","query","questionId","data","responseData","lastResponse","length","flag","updateProgressStatus","step","error","ElMessage","message","scrollTop","scrollHeight","__exports__"],"sourceRoot":""}